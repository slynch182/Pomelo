<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="https://apis.google.com/js/platform.js" async defer></script>
  <title>Simple Webpage</title>
  <style>
    /* CSS to increase the width of the left column in the table */
    table th:first-child,
    table td:first-child {
      width: 200px; /* Adjust the width as needed */
    }
    /* CSS to add border to the table */
    table, th, td {
      border: 1px solid black;
      border-collapse: collapse;
    }
    /* CSS to align headers to the left */
    th {
      text-align: left;
    }
        /* Google Sign-In Button Style */
    #login-button {
      background-color: #4285F4;
      color: white;
      font-size: 16px;
      font-weight: bold;
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      width: 220px; /* Adjust width */
      height: 50px; /* Adjust height */
    }

    #login-button img {
      width: 20px;
      height: 20px;
    }

    #login-button:hover {
      background-color: #357ae8;
    }

    #logout-button {
      background-color: #ff4b4b;
      color: white;
      font-size: 14px;
      padding: 8px 15px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      display: none;
    }
  </style>
</head>
<body>

  <!-- Google Sign-In Button -->
  <div id="g_id_onload"
       data-client_id="937304914639-jvs3kcp6srocp481en53p7ajm8jvfq99.apps.googleusercontent.com"
       data-context="signin"
       data-ux_mode="popup"
       data-callback="requestAccessToken"
       data-auto_prompt="false"
       data-width="180"> <!-- Adjust the width as needed -->
  </div>
  <div class="g_id_signin"
       data-type="standard"
       data-size="large"
       data-theme="outline"
       data-text="sign_in_with"
       data-shape="rectangular"
       data-logo_alignment="left">
  </div>

  <!-- Logout Button -->
  <button id="logout-button" style="display:none;" onclick="logout()">Sign Out</button>

  <h2>User Info</h2>
  <p id="user-info">Not signed in</p>
  <img id="profile-picture" src="" alt="Profile Picture">


  <script>
    const CLIENT_ID = "937304914639-jvs3kcp6srocp481en53p7ajm8jvfq99.apps.googleusercontent.com";
    const USERINFO_URL = "https://www.googleapis.com/oauth2/v3/userinfo";

    function requestAccessToken() {
      google.accounts.oauth2.initTokenClient({
        client_id: CLIENT_ID,
        scope: "openid profile email",
        prompt: "consent",
        callback: (response) => {
          if (response.access_token) {
            localStorage.setItem("access_token", response.access_token);
            fetchUserInfo(response.access_token);
          }
        }
      }).requestAccessToken();
    }
    
    async function fetchUserInfo(token) {
      console.log(token);
      const response = await fetch(USERINFO_URL, {
        headers: { Authorization: `Bearer ${token}` }
      });
      const userData = await response.json();
      console.log("User Data:", userData); // Log the userData to check if name, email and picture is present
  
      document.getElementById("user-info").innerHTML = `
        <b>Name:</b> ${userData.name} <br>
        <b>Email:</b> ${userData.email} <br>
        <img src="${userData.picture}" width="100">
      `;

      document.querySelector(".g_id_signin").style.display = "none";
      document.getElementById("logout-button").style.display = "block";
    }

    function logout() {
      localStorage.removeItem("access_token");
      document.getElementById("user-info").innerHTML = "Not signed in";
      document.getElementById("profile-picture").style.display = "none";
      document.getElementById("login-button").style.display = "flex";
      document.getElementById("logout-button").style.display = "none";
      clearTable(); // Clear the table on logout
    }

    function clearTable() {
      const tableBody = document.querySelector('tbody');
      tableBody.innerHTML = ''; // Clear all rows in the table body
    }

    // Run on page load
    window.onload = function () {
      google.accounts.id.initialize({
        client_id: CLIENT_ID,
        callback: requestAccessToken,
        scope: 'openid profile email' // Ensure these scopes are present
      });
      google.accounts.id.renderButton(
        document.querySelector(".g_id_signin"),
        { theme: "outline", size: "large" }  // customization attributes
      );
    };
  </script>
  
  <p></p>
  <form method="POST" onsubmit="handleSubmit(event)">
    <input type="text" name="text" placeholder="Enter text here">
    <button type="submit">Submit</button>
  </form>
  <h2>Submitted Text</h2>
  <table>
    <thead>
      <tr>
        <th>Text</th>
        <th>Date and Time</th>
      </tr>
    </thead>
    <tbody>
    </tbody>
  </table>
  <script>
    function handleSubmit(event) {
      event.preventDefault();
      const textInput = document.querySelector('input[name="text"]');
      const text = textInput.value;
      // Get the current date and time
      const now = new Date();
      // Format the date and time using the user's local timezone
      const formattedTime = new Intl.DateTimeFormat('default', {
        timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone,
        hour: 'numeric',
        minute: 'numeric',
        second: 'numeric',
        day: 'numeric',
        month: '2-digit',
        year: 'numeric',
        timeZoneName: 'short'
      }).format(now);
      const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
      const tableBody = document.querySelector('tbody');
      const newRow = tableBody.insertRow();
      const textCell = newRow.insertCell();
      const timeCell = newRow.insertCell();
      textCell.textContent = text;
      timeCell.textContent = `${formattedTime} (${timezone})`;
      textInput.value = ''; // Clear the input box
      // Get the timezone and display it
      console.log("Timezone:", timezone);
    }
  </script>
</body>
</html>
